<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Self Introduction Animation</title>
    <style>
        body, html {
            height: 300%;
            margin: 0;
            overflow-y: scroll;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #fff;
            font-family: 'Arial', sans-serif;
        }
        #scrollPrompt {
            position: fixed;
            top: 20%;
            left: 20%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #fff;
            z-index: 1000;
            display: none;
        }
        #portfolio {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
            color: #000;
            z-index: 100;
            display: none;
        }
        canvas {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
        }
        #tooltip {
            display: none;
            position: fixed;
            background-color: white;
            color: black;
            padding: 8px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 1000;
        }
        .portfolio-item {
            background-color: #fff;
            color: #000;
            margin: 20px;
            padding: 20px;
            border-radius: 10px;
        }
        .bubble {
            display: none;
            position: absolute;
            background-color: white;
            color: black;
            padding: 8px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 1000;
            transform: translateY(-60px);
            text-align: center;
        }
        .bubble::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: white transparent transparent transparent;
        }
        .small-bubble {
            display: none;
            position: absolute;
            background-color: white;
            color: black;
            padding: 4px;
            border-radius: 3px;
            font-size: 12px;
            z-index: 1000;
            transform: translateY(-30px);
            text-align: center;
        }
        .white-square {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 600px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            display: none;
            color: black;
            text-align: center;
        }
        .white-square h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .white-square h2 {
            font-size: 24px;
            margin-bottom: 15px;
        }
        .white-square p {
            font-size: 18px;
        }
    </style>
    <script src="https://unpkg.com/three@0.132.2/build/three.min.js"></script>
</head>
<body>
    <div class="portfolio-item">tarakokko3233です! 1番下までスクロールしてね</div>
    <div class="white-square">
        <h1>Portfolio Links</h1>
        <h2>各色の立方体をクリックしてね</h2>
        <p>白:ポートフォリオ</p>
        <p>青:X(Twitter)</p>
        <p>黒:GitHub</p>
        <p>緑:Qiita</p>
        <p>赤:Email送信</p>
        <p>Email:tarakokko32332gmail.com</p>
        <p>※各リンクは新しいタブで開きます</p>
    </div>
    <script>
        let scene = new THREE.Scene();
        let camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        let renderer = new THREE.WebGLRenderer({ alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        let textMeshes = [];
        let linkMeshes = [];
        let loader = new THREE.FontLoader();
        let scrollProgress = 0;

        camera.position.z = 500;

        // selfintroductionのテキスト生成と配置
        loader.load('https://threejs.org/examples/fonts/helvetiker_regular.typeface.json', function(font) {
            const texts = ['tarakokko3233', 'Portfolio Links'];
            let offset = window.innerWidth / 40;
            texts.forEach((text, index) => {
                let yPosition = index * 50 - 25;
                for (let i = 0; i < text.length; i++) {
                    let geometry = new THREE.TextGeometry(text[i], {
                        font: font,
                        size: 30,
                        height: 5,
                        curveSegments: 12,
                    });
                    let material = new THREE.MeshBasicMaterial({ color: 0x000000 });
                    let mesh = new THREE.Mesh(geometry, material);
                    let randomX = Math.random() * window.innerWidth * 0.8 - window.innerWidth * 0.4;
                    let randomY = Math.random() * 200 - 100 + yPosition;
                    mesh.position.set(randomX, randomY, 0);
                    scene.add(mesh);
                    textMeshes.push({mesh, initialPosition: mesh.position.clone(), finalPosition: new THREE.Vector3(i * offset - (text.length - 1) * offset / 2, yPosition, 0)});
                }
            });
            createLinks();
        });

        // リンク図形の生成と配置
        function createLinks() {
            const linkData = [
                { url: 'https://tarakokko3233.github.io/', color: 0xFFFFFF, text: 'Portfolio' },
                { url: 'https://twitter.com/tarakokko3233su', color: 0x1DA1F2, text: 'Twitter' },
                { url: 'https://github.com/tarakokko3233', color: 0x333333, text: 'GitHub' },
                { url: 'https://qiita.com/tarakokko3233', color: 0x55C500, text: 'Qiita' },
                { url: 'mailto:tarakokko3233@gmail.com', color: 0xE4405F, text: 'Email' },
            ];
            const offset = window.innerWidth / (linkData.length + 6);
            linkData.forEach((link, index) => {
                let geometry = new THREE.BoxGeometry(30, 30, 30);
                let material = new THREE.MeshBasicMaterial({ color: link.color });
                let mesh = new THREE.Mesh(geometry, material);
                mesh.position.set((index - linkData.length/1.6 ) * offset + window.innerWidth / 10, -window.innerHeight, 0);
                mesh.userData = { url: link.url, text: link.text };
                scene.add(mesh);
                linkMeshes.push(mesh);

                // 吹き出しの作成
                let bubble = document.createElement('div');
                bubble.classList.add('bubble');
                bubble.innerText = link.text;
                document.body.appendChild(bubble);
                mesh.userData.bubble = bubble;

                mesh.addEventListener('mouseover', function() {
                    this.userData.bubble.style.display = 'block';
                    this.userData.bubble.style.left = (this.position.x + window.innerWidth/2 - this.userData.bubble.offsetWidth/2) + 'px';
                    this.userData.bubble.style.top = (window.innerHeight/2 - this.position.y - 60) + 'px';
                });

                mesh.addEventListener('mouseout', function() {
                    this.userData.bubble.style.display = 'none';
                });

                mesh.addEventListener('click', function() {
                    window.open(this.userData.url, '_blank');
                });
            });
        }

        let animationProgress = 0;
        let animationDuration = 2000;
        let lastTime = null;

        function animate(time) {
            if (!lastTime) {
                lastTime = time;
            }
            let deltaTime = time - lastTime;
            lastTime = time;

            if (animationProgress < 1) {
                animationProgress += deltaTime / animationDuration;
                animationProgress = Math.min(animationProgress, 1);

                textMeshes.forEach(textMesh => {
                    textMesh.mesh.position.lerpVectors(textMesh.initialPosition, textMesh.finalPosition, animationProgress);
                });
            }

            camera.position.y = -scrollProgress * window.innerHeight * 2;

            linkMeshes.forEach(mesh => {
                let targetY = scrollProgress * window.innerHeight * 2 - window.innerHeight;
                mesh.position.y += (targetY - mesh.position.y) * 0.05;

                let scale = 1 + Math.abs(mesh.position.y - targetY) / 500;
                mesh.scale.set(scale, scale, scale);
            });

            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }

        requestAnimationFrame(animate);

        window.addEventListener('resize', function() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        window.addEventListener('scroll', function() {
            scrollProgress = window.scrollY / (document.body.scrollHeight - window.innerHeight);
        });

        document.querySelector('.portfolio-item').addEventListener('click', function() {
            document.querySelector('.white-square').style.display = 'block';
        });

        document.querySelector('.white-square').addEventListener('click', function() {
            this.style.display = 'none';
        });
    </script>
</body>
</html>
